# Segement-Based IMT
This repo contains a dockerfile and instructions to run the [segment-based IMT](https://github.com/midobal/sb-imt) software.

## Requirements
Before building the image, you need to download [SRILM 1.7.3](http://www.speech.sri.com/projects/srilm/download.html) into the same directory as the dockerfile.

## Build
To build the image, you just need to run the following command (provided that you are inside this repo's directory. Otherwise replace `.` with the proper path):

```
docker build -t sbimt .
```

## Run
For simplicity, we are going to assume that we have a folder `data` in which the models are stored and that it is located in `${PWD}`. This folder contains the following:

* phrase-table.gz
* reordering-table.gz
* language-model.lm
* moses.ini

where `phrase-table.gz`, `reordering-table.gz`, `language-model.lm` are the phrase table, reordering table and language model (respectively) obtained as a result of the Moses training. `moses.ini` is the resulting Moses configuration file. Note that **paths in the configuration file should be adapted to match /data/{phrase-table.gz, reordering-model.gz, language-model.lm}**.

### Alignments generation
This software requires of an alignment model. Therefore, prior to its use, alignments must be trained by doing:
```
docker container run -it --rm -v ${PWD}/data/:/data \
-v ${PWD}/src_file:/sbimt/src_file \
-v ${PWD}/tgt_file:/sbimt/tgt_file \
sbimt tools/alignments.sh -s src_file -t tgt_file -o /data/alignments_file {-b}
```

where `src_file` and `tgt_file` are the source and target of the training dataset; `alignments_file` is the file in which to store the alignments (which will be required for using the segment-based software); and the `-b` flags switches from using *Hidden Markov Models* to using *IBM Model 1*.

### User simulation
You can simulate a user working on a segment-based IMT framework by doing:
```
docker container run -it --rm  -v ${PWD}/data/:/data \
-v ${PWD}/source_file:/sbimt/source_file \
-v ${PWD}/reference_file:/sbimt/reference_file \
sbimt python3 simulation.py [-h] -s source_file -r reference_file -c /data/moses.ini \
                     -a /data/alignments_file [-v] [-x] [-p threshold] [-m moses_bin] \
                     -l /data/log_file
```

where:
```
optional arguments:
  -h, --help            show this help message and exit
  -s source_file, --sources source_file
                        file containing the source segments.
  -r reference_file, --references reference_file
                        file containing the reference segments.
  -c moses_ini, --config moses_ini
                        file containing moses configuration.
  -a alignments_file, --alignments alignments_file
                        file containing the alignments generated by alignments.sh
  -v, --verbose         Activate verbose mode.
  -x, --xml             Show XML markup.
  -p threshold, --probability threshold
                        probability threshold. (Default 0.)
  -m moses_bin, --moses moses_bin
                        Path to moses bin. (Default: /opt/moses/bin/moses.)
  -l log_file, --log log_file
                        File to store log.
```

## Citation
On using the [segment-based IMT](https://github.com/midobal/sb-imt) software, please cite the following paper:

>Miguel Domingo and Álvaro Peris and Francisco Casacuberta. Segment-Based Interactive-Predictive Machine Translation. Machine Translation
Journal, 31:163–185, 2017
